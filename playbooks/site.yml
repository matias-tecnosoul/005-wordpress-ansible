---
#playbooks/site.yml
- name: "Instalar WordPress con MySQL"
  hosts: wordpress
  become: yes
  gather_facts: yes

  vars_files:
    - ../group_vars/all.yml  # relativo al playbook
  
  pre_tasks:
    - name: "Actualizar cache de paquetes"
      package:
        update_cache: yes
      changed_when: false
    - name: "Mostrar variables mysql_databases"
      debug:
        var: mysql_databases

  roles:
    - role: geerlingguy.mysql
      tags: ['mysql', 'database']
        
    - role: webserver
      tags: ['wordpress', 'webserver']

  post_tasks:
    - name: "Información de acceso a WordPress"
      debug:
        msg:
          - "WordPress instalado exitosamente!"
          - "URL: http://{{ wordpress_domain }} o http://{{ ansible_host }}"
          - "Completa la instalación desde el navegador"
          - "Base de datos ya configurada automáticamente"
      tags: ['info']